@page "/favoritos"
<head>
    <style>
         body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            margin-right: 10px;
        }

       
        .button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        /* Botão Roxo */
        .button {
            padding: 8px 16px;
            background-color: #6f42c1;
            color: white;
            text-decoration: none;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-block;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .button:hover {
            color: white;
            background-color: #5a32a3;
            transform: translateY(-2px);
        }

   
    </style>
</head>

<NavBar />

<body>
    <div class="container">
        <div class="favorites-title">Favoritos</div>

        <table class="table">
            <thead>
                <tr>
                    <th class="table-header" style="width: 60%">PRODUTOS</th>
                    <th class="table-header" style="width: 20%">PREÇO</th>
                    <th class="table-header" style="width: 15%">AÇÃO</th>
                    <th class="table-header" style="width: 5%"></th>
                </tr>
            </thead>
            <tbody id="favorites-body">
                <!-- Produtos favoritos serão inseridos aqui via JS -->
            </tbody>
        </table>
    </div>
</body>

<Footer />

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("authToken");

        if (!token) {
            alert("Você precisa estar logado para ver seus favoritos.");
            return;
        }

        try {
            const response = await fetch("https://api.anunciapicos.shop/favorite", {
                headers: {
                    "Authorization": `Bearer ${token}`
                }
            });

            if (!response.ok) {
                alert("Erro ao carregar favoritos.");
                return;
            }

            const favoritos = await response.json();
            const tbody = document.getElementById("favorites-body");
            tbody.innerHTML = "";

            if (favoritos.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="text-center">Nenhum favorito encontrado.</td></tr>`;
                return;
            }

            favoritos.forEach(produto => {
                const imagemUrl = (produto.imageUrl && produto.imageUrl.length > 0)
                    ? produto.imageUrl[0]
                    : '/api/placeholder/80/80';

                const row = document.createElement("tr");
                row.classList.add("table-row");

                row.innerHTML = `
                    <td class="table-cell">
                        <div class="product-details">
                            <img src="${imagemUrl}" alt="${produto.name}" class="product-image">
                            <div class="product-info">
                                <div class="product-name">${produto.name}</div>
                            </div>
                        </div>
                    </td>
                    <td class="table-cell">
                        <div class="price">R$${produto.price?.toFixed(2) ?? "0,00"}</div>
                    </td>
                    <td class="table-cell action-cell">
                        <a class="button" href="/visualizarproduto?id=${produto.id}">IR PARA O PRODUTO</a>
                    </td>
                    <td class="table-cell">
                        <span class="remove-icon" onclick="removerFavorito(${produto.id})">✕</span>
                    </td>
                `;

                tbody.appendChild(row);
            });
        } catch (error) {
            console.error("Erro ao buscar favoritos:", error);
            alert("Erro inesperado ao carregar favoritos.");
        }
    });

    async function removerFavorito(id) {
        const token = localStorage.getItem("authToken");
        if (!confirm("Deseja remover este produto dos favoritos?")) return;

        try {
            const response = await fetch(`https://api.anunciapicos.shop/favorite/${id}`, {
                method: "DELETE",
                headers: {
                    "Authorization": `Bearer ${token}`
                }
            });

            if (response.ok) {
                alert("Removido com sucesso.");
                location.reload();
            } else {
                alert("Erro ao remover favorito.");
            }
        } catch (error) {
            console.error("Erro ao remover favorito:", error);
            alert("Erro inesperado.");
        }
    }
</script>
